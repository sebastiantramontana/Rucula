name: Rucula
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
jobs:
  build:
    runs-on: windows-latest
    steps:
        - name: Check out Code
          uses: actions/checkout@v6
          with:
            fetch-depth: 0
        - name: Setup .NET
          uses: actions/setup-dotnet@v5
          with:
            dotnet-version: 10.0.x
        - name: Install wasm-tools workload
          run: dotnet workload install wasm-tools
        - name: Run the Cake script
          uses: cake-build/cake-action@v3
          with:
            script-path: ./Publish/build.cake
        - name: Crear artifact
          uses: actions/upload-artifact@v4
          with:
            name: artifact-build
            path: ./dist
  tailwindcss:
    runs-on: ubuntu-latest
    needs: build
    steps:
        - name: Check out Code
          uses: actions/checkout@v6
          with:
            fetch-depth: 0
        - name: Set up Node.js
          uses: actions/setup-node@v4
          with:
            node-version: '20'
        - name: Install dependencies
          run: npm install
        - name: Clean tailwindcss
          run: npx @tailwindcss/cli -i ./Rucula.FrontEnd/css/styles.css -o ./dist/css/styles.css --minify
        - name: Crear artifact
          uses: actions/upload-artifact@v4
          with:
            name: artifact-tailwindcss
            path: ./dist
  deploy:
    runs-on: ubuntu-latest
    needs: tailwindcss
    steps:
        - name: Descargar artifact Build
          uses: actions/download-artifact@v4
          with:
            name: artifact-build
            path: ./dist
        - name: Descargar artifact Tailwind
          uses: actions/download-artifact@v4
          with:
            name: artifact-tailwindcss
            path: ./dist
        - name: Deploy to Netlify
          env:
            NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
            NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
          run: npx netlify-cli deploy --prod --site="$NETLIFY_SITE_ID" --auth="$NETLIFY_AUTH_TOKEN" --dir=./dist